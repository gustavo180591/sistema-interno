{# templates/ticket/nuevo.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Nuevo Ticket{% endblock %}

{% block body %}
<div class="container py-4" style="max-width: 880px;">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">üÜï Nuevo Ticket</h1>
    <a href="{{ path('ticket_lista') }}" class="btn btn-outline-secondary btn-sm">
      ‚Üê Volver a la lista
    </a>
  </div>

  {# Mensajes flash #}
  {% for label, messages in app.flashes %}
    {% for message in messages %}
      <div class="alert alert-{{ label == 'success' ? 'success' : (label == 'error' ? 'danger' : 'info') }} mb-3">
        {{ message }}
      </div>
    {% endfor %}
  {% endfor %}

  <div class="card shadow-sm">
    <div class="card-body">
      {{ form_start(form, { attr: { novalidate: 'novalidate', class: 'needs-validation' } }) }}

      <div class="row g-3">
        <div class="col-12 col-md-6">
          {{ form_label(form.ticketId, 'ID de Ticket') }}
          {{ form_widget(form.ticketId, {
            attr: {
              placeholder: 'Ej: ABC-123',
              autofocus: true,
              oninput: 'this.value = this.value.toUpperCase()',
              class: 'form-control'
            }
          }) }}
          <div class="form-text">C√≥digo interno para rastrear la tarea.</div>
          {{ form_errors(form.ticketId) }}
        </div>

        <div class="col-12 col-md-6">
          {{ form_label(form.departamento, 'Departamento') }}
          {{ form_widget(form.departamento, { attr: { class: 'form-select' } }) }}
          <div class="form-text">Seleccion√° el destino del trabajo.</div>
          {{ form_errors(form.departamento) }}
        </div>

        <div class="col-12">
          {{ form_label(form.descripcion, 'Descripci√≥n de la tarea') }}
          {{ form_widget(form.descripcion, {
            attr: {
              rows: 6,
              class: 'form-control',
              placeholder: 'Contanos alcance, insumos, links, etc.'
            }
          }) }}
          {{ form_errors(form.descripcion) }}
        </div>

        <div class="col-12 col-md-6">
          {{ form_label(form.estado, 'Estado') }}
          {{ form_widget(form.estado, { attr: { class: 'form-select' } }) }}
          <div class="form-text">Pendiente, En proceso, Terminado o Rechazado.</div>
          {{ form_errors(form.estado) }}
        </div>

        <div class="col-12 col-md-6">
          <label class="form-label d-block">Fecha/Hora (Buenos Aires)</label>
          <input type="text" class="form-control" value="{{ 'now'|date('d/m/Y H:i', 'America/Argentina/Buenos_Aires') }}" readonly>
          <div class="form-text">Se guarda autom√°ticamente al crear.</div>
        </div>
      </div>

      <hr class="my-4">

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-save"></i> Guardar
        </button>
        <a href="{{ path('ticket_lista') }}" class="btn btn-outline-secondary">
          <i class="bi bi-x-lg"></i> Cancelar
        </a>
      </div>

      {{ form_end(form) }}
    </div>
  </div>

  <div class="text-muted small mt-3">
    Atajos: <kbd>Ctrl</kbd> + <kbd>Enter</kbd> para enviar (con foco en descripci√≥n).
  </div>
</div>

{# Atajo Ctrl+Enter y focus suave #}
<script>
  (function () {
    const form = document.querySelector('form.needs-validation');
    const desc = document.querySelector('textarea[name$="[descripcion]"]');
    if (desc) {
      desc.addEventListener('keydown', function (e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          form?.submit();
        }
      });
    }
  })();
</script>
{% endblock %}
